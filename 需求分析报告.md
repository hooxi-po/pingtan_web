# 乡村特色旅游信息系统 — 需求分析报告

封面信息
- 题目：乡村特色旅游信息系统
- 小组成员：刘剑涛、周豪、吴铭锋
- 提交日期：2025年9月8日

---

## 1.3.2 项目技术架构与技术选型

### 1) 技术架构
- 架构模式：B/S 架构，前后端一体化开发（Next.js App Router 兼做 BFF），Browser → Next.js 前端/UI 与 API Routes → 数据库。
- 渲染策略：SSR（SEO 关键页）+ SSG/ISR（内容型列表与详情）混合渲染。
- 身份认证：NextAuth（支持 OAuth/Credentials）。
- 数据访问：Prisma ORM 访问 PostgreSQL。
- 部署：Vercel（优先）/ Docker（可选）。
- 第三方服务：地图与 POI 搜索（百度地图为主，Google Maps 作为扩展）、AI 能力（Gemini）用于智能推荐/摘要。

### 2) 技术选型
- 前端：Next.js 15 + TypeScript；样式体系 Tailwind CSS + shadcn/ui；国际化 next-intl；状态管理 React Context；测试 Jest + Testing Library。
- 后端：Node.js 18+ 运行时；Next.js API Routes（BFF）；Prisma + PostgreSQL；NextAuth 认证。
- 运维与安全：Vercel Serverless/Edge；CORS、安全响应头（X-Frame-Options 等），CI 测试阈值（70% 初始门槛）。

### 3) 选型理由
- Next.js App Router 提供 SSR/SEO、路由与服务端组件协同，BFF 降低前后端协作成本。
- TypeScript 提升可维护性与类型安全；Tailwind + shadcn/ui 让设计系统一致并提高交付效率。
- Prisma 对 PostgreSQL 体验优秀，迁移与类型生成完善；NextAuth 与 Next.js 深度集成。
- Vercel 原生支持 Next.js，具备全球加速与回滚能力；百度地图适配本地化场景，Google Maps 作兜底扩展。

---

## 1.4 项目分工
- 刘剑涛（组长/全栈偏后端）
  - 需求澄清与范围管理；数据库与 API 设计（Prisma 迁移）；认证/权限；部署与环境；质量门槛与测试。
- 周豪（前端负责人）
  - IA 与路由、核心用户流（检索、行程）、UI 组件库封装、地图集成、国际化与可访问性。
- 吴铭锋（数据/测试/文档）
  - 数据采集与清洗（景点/餐饮/民宿）；资讯运营；测试计划与用例；CI 执行；文档与知识库。

备注：重大需求与合并前需双人评审，三人互为备份。

---

## 1.6 完成项目已具备的条件

### 1.6.1 技术知识储备
- 前端：React/Next.js、TypeScript、Tailwind、shadcn/ui、App Router。
- 后端/数据：API 设计、Prisma ORM、PostgreSQL、查询优化意识。
- 认证/安全：NextAuth、常见 Web 安全（XSS/CORS/Headers）。
- 测试：Jest、Testing Library，初始覆盖率阈值 70%。
- 地图与位置：百度地图 JS API、POI/天气；Google Maps Loader 基础。
- 部署：Vercel、Docker（可选）。

### 1.6.2 开发工具与环境安装
- VS Code/Trae IDE、ESLint/Prettier、Node.js 18+、npm。
- PostgreSQL、Prisma CLI；Git 与 Vercel 账号；环境变量规范（数据库、认证、地图/AI）。

### 1.6.3 相关案例查阅
- 同类产品：携程/马蜂窝目的地与路线规划页面；小红书相关旅游内容体验。
- 技术案例：Next.js 官方示例（App Router/SEO/i18n）、Prisma 官方 schema 设计、Vercel 最佳实践。
- 学术/行业：旅游推荐系统、基于地理位置的 POI 推荐、路线规划与多目标优化等综述。

---

## 1.7 项目预算（可上线试运行口径）

说明：以“轻量试运行”规模估算，不含人员工资，仅列现金支出与第三方服务成本，单位：人民币。

| 成本项 | 规格/说明 | 月度估算 | 年度估算 |
|---|---|---:|---:|
| 域名 | .com/.cn 等 | 8–12 | 80–120 |
| 部署/托管 | Vercel 免费层可起步；若升级则 100–300/月 | 0–300 | 0–3600 |
| 数据库 | Neon/Supabase 免费层可起步；若升级 100–300/月 | 0–300 | 0–3600 |
| 第三方地图 | 开发者免费配额通常足够；超额按量 50–300/月 | 0–300 | 0–3600 |
| AI（可选） | Gemini 超配额备用 100–500/月 | 0–500 | 0–6000 |
| 监控日志（可选） | Sentry/自建 | 0–200 | 0–2400 |
| 其他杂项 | 证书/备份/存储等 | 0–200 | 0–2400 |

- 试运行起步：0–300 元/月可落地；
- 若考虑稳定上线与小规模流量：约 200–1,200 元/月；年度 2,400–10,000 元作为参考区间。

---

## 1.8 预计困难与预防措施
- 技术难点：
  - 地图/路线策略复杂度高：采用“渐进增强”，先实现基础检索与路径可视化；为常见路线做缓存；提供退化方案。
  - SEO 与性能：关键页 SSR，列表 ISR/分页；组件懒加载；指标红线（LCP、TTFB、CLS）；慢查询优化与索引。
  - 数据一致性与扩展：使用 Prisma 迁移；统一命名与索引规范；灰度发布。
  - 认证与权限：统一中间件校验；接口限流与重试；敏感接口校验来源与 token。
- 团队协作：
  - 防止范围蔓延：里程碑+冻结期；变更需评审与复盘。
  - 质量保障：Git 分支策略、PR 模板、Lint 和测试门槛；关键改动双人 Review。
  - 知识传递：飞书/Notion 知识库，接口契约与约定沉淀。
- 数据来源与合规：
  - API 配额与稳定性：设置重试与回退；监控错误率；本地缓存与静态化；
  - 隐私与合规：不采集敏感数据；用户行为匿名化/脱敏；遵守地图数据协议。

---

## 1.9 参考文献（示例）
1) Next.js Documentation. Next.js 15 App Router Guide. 2024. https://nextjs.org/docs
2) Prisma Documentation. Prisma ORM with PostgreSQL. 2024. https://www.prisma.io/docs
3) PostgreSQL 14 Documentation. 2024. https://www.postgresql.org/docs/
4) NextAuth.js Documentation. 2024. https://authjs.dev/
5) Tailwind CSS Documentation. 2024. https://tailwindcss.com/docs
6) shadcn/ui Documentation. 2024. https://ui.shadcn.com/
7) 百度地图开放平台文档. 2024. https://lbsyun.baidu.com/
8) Google Maps Platform Docs. 2024. https://developers.google.com/maps
9) Google AI Studio — Gemini API Docs. 2024. https://ai.google.dev/
10) Vercel — Next.js on Vercel Best Practices. 2024. https://vercel.com/docs
11) Ricci, F., Rokach, L., Shapira, B. Recommender Systems Handbook. Springer, 2022.
12) Lu, J., et al. Recommender system application developments: A survey. Decision Support Systems, 74, 2015.
13) Yin, H., et al. Joint Modeling of POI Popularity and User Mobility for POI Recommendation. WWW, 2017.
14) ISO/IEC 25010:2011. Systems and software quality models. ISO, 2011.

---

## 2. 系统需求分析

### 2.1 业务功能需求
- 角色
  - 访客：浏览景点/资讯、检索、地图查看与筛选。
  - 注册用户：登录/登出、收藏/点赞、创建与管理个人行程。
  - 管理员：内容管理（景点/餐饮/民宿/行程模板/资讯）、运营与数据洞察。
- 核心功能
  - 用户与权限：注册/登录、个人信息、会话管理。
  - 景点信息：列表/详情（图片、开放时间、票价、位置、标签、人气、预计时长等），筛选与排序。
  - 地图与检索：关键字/类别 POI 搜索、附近探索、地图可视化。
  - 路线规划：起终点选择与基础策略（步行/驾车），结果可视化与分享。
  - 行程管理：行程按天与顺序管理（添加/排序/备注/复制），基础预算提示。
  - 美食与住宿：餐厅/民宿列表与详情，关联“附近景点”推荐。
  - 资讯模块：旅游新闻/活动公告发布与浏览。
  - 互动行为：收藏、点赞、浏览记录，用于个性化与统计。
- 可选增强
  - AI 辅助行程生成与资讯摘要；多语言（中/英/日）扩展；社交分享。

### 2.2 非功能需求与指标
- 性能：主页 LCP ≤ 2.5s（P75），TTFB ≤ 500ms（SSR 页）；API P95 ≤ 800ms；列表分页与懒加载；地图资源按需加载与缓存。
- 安全：NextAuth 标准流程与强密码；CORS/CSRF/限流；敏感数据不落日志；安全响应头策略。
- 可扩展与可维护：
  - API 分层与域模型清晰；Prisma 迁移；统一命名/索引规范；
  - 测试覆盖率 ≥ 70%，关键路径优先；
  - 前端/后端错误与性能监控、慢查询跟踪。

### 2.3 用例图（SVG 可嵌入）

<svg width="760" height="420" viewBox="0 0 760 420" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="系统用例图">
  <defs>
    <style>
      .actor { font: 14px sans-serif; }
      .usecase { fill:#fff; stroke:#333; }
      .title { font: 16px sans-serif; font-weight:700; }
      .label { font: 12px sans-serif; }
      .line { stroke:#555; stroke-width:1.2; }
    </style>
  </defs>
  <text x="20" y="28" class="title">乡村特色旅游信息系统 — 用例图</text>

  <!-- Actors -->
  <circle cx="70" cy="110" r="24" fill="#f2f2f2" stroke="#333"/>
  <text x="40" y="155" class="actor">访客</text>
  <circle cx="70" cy="220" r="24" fill="#f2f2f2" stroke="#333"/>
  <text x="30" y="265" class="actor">注册用户</text>
  <circle cx="70" cy="330" r="24" fill="#f2f2f2" stroke="#333"/>
  <text x="35" y="375" class="actor">管理员</text>

  <!-- System boundary -->
  <rect x="180" y="60" width="540" height="320" fill="#fafafa" stroke="#333" rx="8"/>
  <text x="190" y="82" class="label">系统边界</text>

  <!-- Use cases -->
  <ellipse class="usecase" cx="320" cy="120" rx="110" ry="28"/>
  <text x="250" y="125" class="label">浏览/检索景点与资讯</text>

  <ellipse class="usecase" cx="520" cy="120" rx="110" ry="28"/>
  <text x="470" y="125" class="label">地图查看与附近探索</text>

  <ellipse class="usecase" cx="320" cy="200" rx="110" ry="28"/>
  <text x="270" y="205" class="label">用户登录/注册</text>

  <ellipse class="usecase" cx="520" cy="200" rx="120" ry="28"/>
  <text x="455" y="205" class="label">行程创建/编辑/排序</text>

  <ellipse class="usecase" cx="320" cy="280" rx="110" ry="28"/>
  <text x="275" y="285" class="label">收藏/点赞/浏览记录</text>

  <ellipse class="usecase" cx="520" cy="280" rx="120" ry="28"/>
  <text x="480" y="285" class="label">路线规划与可视化</text>

  <ellipse class="usecase" cx="420" cy="350" rx="150" ry="28"/>
  <text x="330" y="355" class="label">内容管理（景点/餐饮/民宿/资讯）</text>

  <!-- Associations -->
  <line class="line" x1="94" y1="110" x2="210" y2="110"/>
  <line class="line" x1="94" y1="110" x2="410" y2="120"/>

  <line class="line" x1="94" y1="220" x2="210" y2="200"/>
  <line class="line" x1="94" y1="220" x2="410" y2="200"/>
  <line class="line" x1="94" y1="220" x2="210" y2="280"/>
  <line class="line" x1="94" y1="220" x2="410" y2="280"/>

  <line class="line" x1="94" y1="330" x2="270" y2="350"/>
</svg>

### 2.4 E-R 图与数据库设计（核心）

- 主要实体与关系（节选）：
  - User 1—N UserAction；UserAction（可选）N—1 News。
  - Itinerary 1—N ItineraryItem；ItineraryItem N—1 Attraction。
  - News 独立管理资讯；Attraction/Restaurant/Accommodation 分别管理景点/餐馆/民宿；
  - NextAuth 相关：User、Account、Session、VerificationToken。

<svg width="900" height="520" viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="系统核心 E-R 图">
  <defs>
    <style>
      .box { fill:#fff; stroke:#333; rx:6; }
      .title { font: 14px sans-serif; font-weight:700; }
      .field { font: 12px sans-serif; }
      .rel { stroke:#555; stroke-width:1.2; }
      .cap { font: 11px sans-serif; fill:#333; }
    </style>
  </defs>

  <!-- User -->
  <rect class="box" x="40" y="40" width="180" height="110"/>
  <text class="title" x="55" y="60">User</text>
  <text class="field" x="55" y="80">id (PK)</text>
  <text class="field" x="55" y="98">email</text>
  <text class="field" x="55" y="116">name / image</text>

  <!-- UserAction -->
  <rect class="box" x="290" y="30" width="220" height="130"/>
  <text class="title" x="305" y="50">UserAction</text>
  <text class="field" x="305" y="70">id (PK), userId (FK)</text>
  <text class="field" x="305" y="88">actionType, targetType, targetId</text>
  <text class="field" x="305" y="106">newsId (FK, optional)</text>

  <!-- News -->
  <rect class="box" x="600" y="30" width="200" height="130"/>
  <text class="title" x="615" y="50">News</text>
  <text class="field" x="615" y="70">id (PK), title</text>
  <text class="field" x="615" y="88">content, lang, published</text>
  <text class="field" x="615" y="106">viewCount</text>

  <!-- Itinerary -->
  <rect class="box" x="60" y="230" width="200" height="120"/>
  <text class="title" x="75" y="250">Itinerary</text>
  <text class="field" x="75" y="270">id (PK), title, days</text>
  <text class="field" x="75" y="288">budget, tags, isPublic</text>

  <!-- ItineraryItem -->
  <rect class="box" x="320" y="230" width="220" height="120"/>
  <text class="title" x="335" y="250">ItineraryItem</text>
  <text class="field" x="335" y="270">id (PK), itineraryId (FK)</text>
  <text class="field" x="335" y="288">attractionId (FK), day, order</text>

  <!-- Attraction -->
  <rect class="box" x="600" y="220" width="230" height="140"/>
  <text class="title" x="615" y="240">Attraction</text>
  <text class="field" x="615" y="260">id (PK), nameZh, images</text>
  <text class="field" x="615" y="278">latitude, longitude</text>
  <text class="field" x="615" y="296">ticketPrice, popularity</text>

  <!-- Relations -->
  <line class="rel" x1="220" y1="95" x2="290" y2="95"/>
  <text class="cap" x="230" y="85">1</text>
  <text class="cap" x="260" y="110">N</text>

  <line class="rel" x1="510" y1="95" x2="600" y2="95"/>
  <text class="cap" x="520" y="85">0..1</text>
  <text class="cap" x="565" y="110">N</text>

  <line class="rel" x1="260" y1="290" x2="320" y2="290"/>
  <text class="cap" x="270" y="280">1</text>
  <text class="cap" x="300" y="305">N</text>

  <line class="rel" x1="540" y1="290" x2="600" y2="290"/>
  <text class="cap" x="550" y="280">N</text>
  <text class="cap" x="585" y="305">1</text>
</svg>

> 字段与关系以核心展示为主，完整字段请以实际数据库 schema 为准。

---

## 3. 产品路线图（Roadmap）与迭代里程碑

### 3.1 路线图（按 12–16 周试运行目标）
- 里程碑 M1（第 1–3 周）：基础信息架构与技术底座
  - 搭建 Next.js/TS/Tailwind/shadcn；Prisma + PostgreSQL；认证（NextAuth）；地图 SDK 初始化；CI（Lint/测试）。
- 里程碑 M2（第 4–6 周）：景点/地图与检索
  - 景点数据模型与导入；列表/详情与筛选；地图展示与附近探索；基础 SEO。
- 里程碑 M3（第 7–9 周）：行程管理与路线可视化
  - 行程按天与顺序管理；路线基础策略可视化；收藏/点赞；性能优化（懒加载/缓存）。
- 里程碑 M4（第 10–12 周）：资讯与运营后台、试运行
  - 资讯发布/浏览；后台内容管理；监控告警；压测与灰度；上线试运行与问题收敛。
- 可选增强（第 13–16 周）：AI 行程草案与摘要、多语言扩展、分享/导出。

### 3.2 MoSCoW 优先级
- Must-have：
  - 景点列表/详情与筛选；地图展示与附近探索；用户登录/注册；行程创建/编辑；基础路线可视化；资讯浏览；性能与安全基线。
- Should-have：
  - 收藏/点赞；后台内容管理；分页与搜索优化；基础监控与日志；SSR/SEO 优化。
- Could-have：
  - AI 行程草案与资讯摘要；多语言扩展；社交分享；导出分享。
- Won’t-have（本阶段不做）：
  - 复杂动态交通策略、深度推荐系统、重型移动端离线包。

### 3.3 RICE 评估（样例）

| 功能 | Reach（12 周） | Impact | Confidence | Effort（人周） | RICE 分数 |
|---|---:|---:|---:|---:|---:|
| 景点列表/详情+筛选 | 1,000 用户 | 3 | 0.8 | 3 | 800 |
| 地图展示+附近探索 | 1,000 用户 | 3 | 0.7 | 4 | 525 |
| 行程创建/编辑 | 800 用户 | 3 | 0.7 | 4 | 420 |
| 路线可视化（基础） | 800 用户 | 2 | 0.7 | 3 | 373 |
| 登录/注册（NextAuth） | 1,000 用户 | 2 | 0.9 | 2 | 900 |
| 资讯发布/浏览 | 600 用户 | 2 | 0.7 | 2 | 420 |
| 收藏/点赞 | 600 用户 | 1 | 0.8 | 1.5 | 320 |
| 后台内容管理 | 10 运营 | 2 | 0.7 | 3 | 47 |
| AI 行程草案（可选） | 200 用户 | 2 | 0.5 | 2.5 | 80 |

注：RICE = Reach × Impact × Confidence ÷ Effort；数值为估算，随数据验证动态调整。

---

## 4. 成功指标（跨章节）
- 质量：单元/组件测试覆盖率 ≥ 70%，关键路径 80%+。
- 体验：首屏 LCP ≤ 2.5s（P75），TTFB ≤ 500ms；前端错误率 ≤ 1%。
- 功能：完成景点/地图/行程/资讯/认证等 10+ 核心页面与流程；
- 数据：≥ 200 条结构化数据样本，支持演示；路线基础可用；
- 稳定：试运行 2–4 周无阻塞性缺陷，SLA ≥ 99%。